services:
  backend:
    build:
      context: .
      dockerfile: ./backend/Dockerfile
    ports:
      - 80:8000
    volumes:
      - ./backend/app:/code/app
    env_file:
      - .env
    command: ["fastapi", "dev", "main.py", "--host", "0.0.0.0", "--port", "8000"]

  influxdb:
    image: influxdb:3-core
    container_name: influxdb3-core
    ports:
      - "8181:8181"
    volumes:
      - influxdb3_data:/var/lib/influxdb3/data
      - influxdb3_meta:/var/lib/influxdb3/meta
    environment:
      INFLUXDB3_ADMIN_TOKEN_FILE: "token.json"
      INFLUXDB3_HTTP_BIND_ADDR: "0.0.0.0:8181"
      INFLUXDB3_LOG_FILTER: "info"
      INFLUXDB3_NODE_IDENTIFIER_PREFIX: "node1"
    restart: unless-stopped

  explorer:
    image: influxdata/influxdb3-ui:1.4.0
    container_name: influxdb3-explorer
    ports:
      - "8888:80"
    volumes:
      - ./config:/app-root/config:ro
    restart: unless-stopped

volumes:
  influxdb3_data:
  influxdb3_meta:
